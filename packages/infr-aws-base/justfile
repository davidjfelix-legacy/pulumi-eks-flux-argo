
# Default recipe, run on `just`
_default:
  just --list

# Remove output artifacts
clean:
  rm -rf out

# Use Pulumi to deploy. Pass -y to automatically deploy
deploy stack="main" ci="": clean
  pulumi up --stack {{stack}} {{ci}}
  mkdir -p out/.kube
  pulumi stack --stack {{stack}} output kubeconfig > out/.kube/config

# Pass CI specific args to deploy
deploy-ci stack="main":
  @just _deploy {{stack}} -y

# Use Pulumi to destroy. Pass -y to automatically deploy
undeploy stack *args:
  pulumi down --stack {{stack}} {{args}}

undeploy-ci stack="main":
  @just undeploy {{stack}} -y
