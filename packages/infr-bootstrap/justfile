
# Default recipe, run on `just`
[private]
default:
  just --list

# FIXME: this needs more interactivity
bootstrap:
  #!/usr/bin/env -S bash -euxo pipefail
  read -p "FIXME: prompt: " prompt
  echo ${prompt}

# Remove output artifacts
clean:
  rm -rf out

# Use Pulumi to deploy. Pass -y to automatically deploy
deploy *ARGS: clean
  pulumi up --stack main {{ARGS}}
  mkdir -p out/.ssh/
  pulumi stack --show-secrets --stack main output fluxcdPrivateKeyOpenssh > out/.ssh/id_rsa


# Pass CI specific args to deploy
deploy-ci:
  @just deploy -y

# Use Pulumi to destroy. Pass -y to automatically deploy
undeploy *ARGS:
  pulumi down --stack main {{ARGS}}

undeploy-ci:
  @just undeploy -y
